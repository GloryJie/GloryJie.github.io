[{"content":" å°é¢æ˜¯éŸ©å›½çš„Arinï¼Œä¸‹é¢æ˜¯æŠ–éŸ³ç»å¸¸åˆ·åˆ°çš„ä¸€ä¸ªè£…æ‰®\nè¿™é‡Œç›´æ¥ä½¿ç”¨SDKMANè¿›è¡Œjdk21çš„ä¸‹è½½ã€‚ï¼ˆå®‰åˆ©SDKManè¿™ä¸ªå·¥å…·ï¼Œæœ¬åœ°ç”¨æ¥åˆ‡æ¢å„ç‰ˆæœ¬sdkæ–¹ä¾¿ï¼‰\n1 sdk install java 22.0.1-oracle æ­£å¼å‘å¸ƒçš„ï¼ˆéé¢„è§ˆï¼‰æ–°ç‰¹æ€§ã€‚å¹¶å¯¹è¯­æ³•å±‚é¢çš„ï¼Œä¹Ÿå°±æ˜¯æ ¸å¿ƒJavaåº“ç›¸å…³çš„åšä¸ªç®€å•è®°å½•ã€‚\nJEP åˆ†ç±» è™šæ‹Ÿçº¿ç¨‹ æ ¸å¿ƒ Java åº“ æœ‰åºé›†åˆ æ ¸å¿ƒ Java åº“ Record æ¨¡å¼ æ ¸å¿ƒ Java åº“ switch æ¨¡å¼åŒ¹é… æ ¸å¿ƒ Java åº“ åˆ†ä»£ ZGC HotSpot å¼ƒç”¨ Windows 32 ä½ x86 ç«¯å£ HotSpot å‡†å¤‡ç¦æ­¢åŠ¨æ€åŠ è½½ä»£ç† HotSpot å¯†é’¥å°è£…æœºåˆ¶ API å®‰å…¨åº“ æœ‰åºé›†åˆ JEP 431\nå¯¹äºæœ‰åºé›†åˆï¼Œï¼Œå¦‚Listï¼ˆArrayListã€LinkListç­‰ï¼‰ã€Deqeueã€SortedSetç­‰ï¼Œæ²¡æœ‰ä¸€ä¸ªå…±åŒçš„æ“ä½œè¯­ä¹‰apiåŒºé˜ŸåŒç«¯å°±è¡Œæ“ä½œã€‚ä¸‹é¢è·ç¦»å–ç¬¬ä¸€ä¸ªã€æœ€ä¼˜ä¸€ä¸ªå…ƒç´ çš„å½“å‰æ–¹å¼ã€‚\nCollection First element Last element List list.get(0) list.get(list.size() - 1) Deque deque.getFirst() deque.getLast() SortedSet sortedSet.first() sortedSet.last() LinkedHashSet linkedHashSet.iterator().next() // missing å®é™…å¼€å‘ä¸­æœ€å¸¸è§çš„å°±æ˜¯list.get(0)ã€list.get(list.size() - 1)ã€‚åœ¨ä¸Šè¿°èƒŒæ™¯ä¸‹ï¼Œæ–°å¢äº†ä¸‰ä¸ªæ¥å£ï¼šSequencedCollectionã€SequencedSetã€SequencedMapã€‚ä¸‹é¢æ¥çœ‹ä¸‹è¿™ä¸‰ä¸ªæ¥å£çš„ç›¸å…³å®šä¹‰ã€‚\nä¸‹é¢æ˜¯ä¸‰ä¸ªæ¥å£åœ¨é›†åˆæ¡†æ¶ä½“ç³»ä¸­çš„å…³ç³»ã€‚ SequencedCollectionæ¥å£å®šä¹‰å¦‚ä¸‹ï¼Œéƒ½æ˜¯å¯¹äºé¦–å°¾æ“ä½œçš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªåè½¬é¡ºåºçš„æ“ä½œã€‚ SequencedSetç»§æ‰¿è‡ªSequenceCollectionï¼Œé‡å†™äº†reversedæ–¹æ³•çš„è¿”å›å€¼è€Œå·²ã€‚ SequencedMapæ˜¯è‡ªå·±å•ç‹¬å®šä¹‰çš„ï¼Œéœ€è¦ç•™æ„ä¸¤ä¸ªæ–¹æ³•çš„è¿”å›å€¼\nsequencedKeySetè¿”å›SequencedSet sequenedValuesè¿”å›SequencdCollection å¯¹äºé¦–å°¾æ“ä½œå°±ä¸éœ€è¦è‡ªå·±å»éå†æˆ–è€…æŒ‡å®šindexäº†ï¼Œè¿˜åŠ å¤šäº†ä¸€ä¸ªreverseæ“ä½œã€‚\nRecordæ¨¡å¼ JEP440\nå¯¹äºRecordåœ¨æ—¥å¸¸ä½¿ç”¨è€…ï¼Œä¸ªäººè¿˜æ²¡æœ‰ä½¿ç”¨ä¸Šï¼ˆæ—¥å¸¸å·¥ä½œè¿˜åœ¨Java8ï¼‰ï¼Œæ„Ÿè§¦ä¸æ˜¯å¾ˆæ·±ï¼Œå…ˆä¸ç ”ç©¶ã€‚\nswitchæ”¯æŒæ•°æ®ç±»å‹åŒ¹é… ç›´è§‚æ„Ÿå—å°±æ˜¯æ”¯æŒäº†æ•°æ®ç±»å‹åŒ¹é…ï¼Œè¿˜æ”¯æŒnullåŒ¹é…ğŸ‘ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class Main { public static void main(String[] args) { System.out.println(getTypeStr(1)); System.out.println(getTypeStr(\u0026#34;hello\u0026#34;)); System.out.println(getTypeStr(12.12d)); System.out.println(getTypeStr(123L)); System.out.println(getTypeStr(true)); } public static String getTypeStr(Object o) { return switch (o) { case null -\u0026gt; \u0026#34;null\u0026#34;; case Integer i -\u0026gt; String.format(\u0026#34;int %d\u0026#34;, i); case Long l -\u0026gt; String.format(\u0026#34;long %d\u0026#34;, l); case Double d -\u0026gt; String.format(\u0026#34;double %f\u0026#34;, d); case String s -\u0026gt; String.format(\u0026#34;String %s\u0026#34;, s); case Boolean b -\u0026gt; String.format(\u0026#34;Boolean %b\u0026#34;, b); default -\u0026gt; o.toString(); }; } } VirtualThreadè™šæ‹Ÿçº¿ç¨‹ JEP444\nä»€ä¹ˆäº‹è™šæ‹Ÿçº¿ç¨‹ï¼Ÿçœ‹ä¸‹VirtualThreadç±»ä¸Šçš„æ³¨é‡Šã€‚ï¼ˆä¸€å¥è¯å°±æ˜ç™½äº†ï¼‰\nA thread that is scheduled by the Java virtual machine rather than the operating system.\nå¯¹äºå¼€å‘è€…æ¥è¯´è™šæ‹Ÿçº¿ç¨‹åœ¨ä½¿ç”¨ä½“éªŒä¸Šå’Œ Thread å‡ ä¹æ²¡æœ‰åŒºåˆ«ï¼Œä¸ä¹‹å‰çš„ API äº’ç›¸å…¼å®¹ï¼Œä½†æ˜¯ç›¸æ¯”ä¹‹ä¸‹è™šæ‹Ÿçº¿ç¨‹èµ„æºå ç”¨éå¸¸å°‘ã€‚ä¸‹é¢æ¥å¯¹æ¯”ä¸€ä¸‹ä½¿ç”¨ã€‚\nThreadç±»çš„ä½¿ç”¨æ–¹å¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // åŸå§‹çº¿ç¨‹çš„ä½¿ç”¨ Thread thread = new Thread(() -\u0026gt; { System.out.println(\u0026#34;hello thread\u0026#34;); }, \u0026#34;SystemThread\u0026#34;); thread.start(); // è™šæ‹Ÿçº¿ç¨‹ Thread virtualThread = Thread.ofVirtual().name(\u0026#34;VirtualThread\u0026#34;).unstarted(() -\u0026gt; { System.out.println(\u0026#34;hello virtual thread\u0026#34;); }); virtualThread.start(); Thread.startVirtualThread(() -\u0026gt; { System.out.println(\u0026#34;hello virtual thread, startVirtualThread\u0026#34;); }); ExecutorServiceçº¿ç¨‹æ± ä½¿ç”¨æ–¹å¼\n1 2 3 4 5 6 7 8 9 10 11 // åˆ›å»ºå¹¶æäº¤æ‰§è¡Œè™šæ‹Ÿçº¿ç¨‹ long start = System.currentTimeMillis(); try (var executor = Executors.newVirtualThreadPerTaskExecutor()) { IntStream.range(0, 10_000).forEach(i -\u0026gt; { executor.submit(() -\u0026gt; { Thread.sleep(Duration.ofSeconds(1)); return i; }); }); } System.out.println(\u0026#34;time:\u0026#34; + (System.currentTimeMillis() - start) + \u0026#34;ms\u0026#34;); VirtualThreadæ˜¯ä¸éœ€è¦æ± åŒ–çš„ï¼Œç”¨çš„æ—¶å€™æ–°å»ºå³å¯ã€‚åç»­ä¼šå¯¹è¿™ä¸€å—è¿›ä¸€æ­¥ç ”ç©¶å­¦ä¹ ã€‚ é™„å½• å‚è€ƒ Java 21 æ–°åŠŸèƒ½ä»‹ç» (LTS) å’–å•¡å±‹è§†é¢‘ï¼šé€šå‘Java21-02-Javaè™šæ‹Ÿçº¿ç¨‹ å’–å•¡å±‹è§†é¢‘ï¼šé€šå‘Java21-04-æ–°çš„API å’–å•¡å±‹è§†é¢‘ï¼šé€šå‘Java21-07-å®Œæ•´çš„æ¨¡å¼åŒ¹é…ã€æœ€ç»ˆå›ã€‘ ","date":"2024-04-21T11:33:39+08:00","image":"https://gloryjie.github.io/p/java21%E8%AF%AD%E6%B3%95%E7%89%B9%E6%80%A7/cover_hua0dda0fd1975efc7e10ecc9bbca3e0a7_198222_120x120_fill_q75_box_smart1.jpeg","permalink":"https://gloryjie.github.io/p/java21%E8%AF%AD%E6%B3%95%E7%89%B9%E6%80%A7/","title":"Java21è¯­æ³•ç‰¹æ€§"},{"content":" å°é¢æ˜¯ã€Šæ–—ç½—å¤§é™†2ç»ä¸–å”é—¨ã€‹ä¸­çš„å‡Œè½å®¸ï¼Œç”¨å†°æŠ€èƒ½, å›¾ç‰‡ç”±AIç”Ÿæˆï¼Œå®Œæˆå›¾ç‰‡æ”¾åœ¨é™„å½•ä¸­\nè¯¾ç¨‹é¦–é¡µä»¥åŠå®éªŒè¯´æ˜ç›¸å…³ä»‹ç»é“¾æ¥åœ¨é™„å½•ä¸­ã€‚\nè¯¾ç¨‹ç†è§£ ç®€å•çš„è¯´ï¼Œå°±æ˜¯ç”¨Goæ¥å®ç°ä¸€ä¸ªå•æœºå¤šè¿›ç¨‹ç‰ˆæœ¬çš„MapReduceã€‚(MapReduceè®¡ç®—æ¨¡å‹å¯ä»¥å»æœç´¢ç›¸å…³æ–‡ç« äº†è§£)ã€‚ä¼šæœ‰å¦‚ä¸‹ä¸¤ç§ç±»å‹çš„è¿›ç¨‹\nCoordinatoråè°ƒè€…ï¼šä½œä¸ºä¸€ä¸ªåè°ƒç€ï¼Œåè°ƒMapã€Reduceçš„ä»»åŠ¡äº¤ç»™ä¸åŒçš„Workerå»æ‰§è¡Œï¼Œåè°ƒMapã€Reduceé˜¶æ®µï¼ˆæ‰§è¡Œå®Œæ‰€æœ‰Mapä»»åŠ¡ä¹‹åæ‰å¯ä»¥å»æ‰§è¡ŒReduceä»»åŠ¡ï¼‰ Workeræ‰§è¡Œå™¨ï¼šä»»åŠ¡æ‰§è¡Œè€…ï¼Œæ‰§è¡ŒMapã€Reduceä»»åŠ¡ èµ·æ¥ä¸€ä¸ªMRä»»åŠ¡åï¼Œåªä¼šæœ‰ä¸€ä¸ªCoordinatorè¿›ç¨‹ï¼Œå¯ä»¥æœ‰å¤šä¸ªWorkerè¿›ç¨‹ã€‚éœ€è¦å»è€ƒè™‘å’Œè§£å†³ä¸‹é¢çš„å‡ ä¸ªé—®é¢˜\nCoordinatorå¦‚ä½•æ„ŸçŸ¥workerï¼Ÿ æ‰€æœ‰Mapä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œæ–¹å¯è¿›è¡ŒReduceä»»åŠ¡ï¼ŒCoordinatorå¦‚ä½•è¿›è¡Œåè°ƒåˆ†é…ä»»åŠ¡ï¼Ÿ Mapä»»åŠ¡ä¼šäº§ç”Ÿä¸´æ—¶æ–‡ä»¶ä½œä¸ºè¾“å‡ºï¼Œéœ€è¦æ”¶é›†æ‰€æœ‰çš„ä¸´æ—¶æ–‡ä»¶å†…å®¹ä½œä¸ºReduceçš„è¾“å…¥ï¼Œä¸¤ç§ä»»åŠ¡ä¹‹é—´å¦‚ä½•é…åˆï¼Ÿ Workerå¯èƒ½ä¼šcrashï¼Œæ­£åœ¨å¤„ç†çš„ä»»åŠ¡è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ Workeræ‰§è¡Œä»»åŠ¡æ—¶é—´å¯èƒ½è¿‡é•¿ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ è¯¾ç¨‹å‰ç½®çŸ¥è¯† 1ã€MapReduceçš„è¿è¡Œæœºåˆ¶\n2ã€Goå†…ç½®çš„RPCé€šä¿¡\n3ã€Goçš„é”ä¿æŠ¤æœºåˆ¶\n4ã€Goæœ¬åœ°çš„å®šæ—¶ä»»åŠ¡time.Ticker ä»»åŠ¡è¿è¡Œæœºåˆ¶ Coordinatorçš„æ‰§è¡Œå…¥å£åœ¨mrcoordinator.goæ–‡ä»¶ä¸­ï¼Œé€»è¾‘å°±æ˜¯åˆ›å»ºä¸€ä¸ªCoordinatorç»“æ„ä½“å®ä¾‹ï¼Œä¹‹åå¾ªç¯æ‰§è¡ŒDone()æ–¹æ³•ï¼Œæ¥åˆ¤æ–­Coordinatoræ˜¯å¦å·²ç»ç»“æŸï¼Œè¿›è€Œåˆ¤æ–­æ•´ä¸ªMRä»»åŠ¡æ˜¯å¦ç»“æŸã€‚\nWorkerçš„æ‰§è¡Œå…¥å£åœ¨mrworker.goæ–‡ä»¶ä¸­ï¼Œé€»è¾‘å°±æ˜¯åŠ è½½Mapã€Reduceçš„å‡½æ•°ï¼Œä¹‹åè°ƒç”¨workerçš„Workeræ–¹æ³•ã€‚å½“å‰Workerè¿›ç¨‹å…·ä½“è¯¥å¦‚ä½•æ‰§è¡ŒMapã€Reduceä»»åŠ¡ï¼Œéœ€è¦è‡ªå·±åœ¨Workeræ–¹æ³•å†…åŒºå®ç°ã€‚\nå®éªŒåªéœ€è¦ä¿®æ”¹src/mré‡Œè¾¹çš„ä¸‰ä¸ªæ–‡ä»¶ï¼Œåœ¨é‡Œè¾¹ä¹¦å†™è‡ªå·±çš„é€»è¾‘ä»£ç \ncoordinator.go worker.go rpc.go å®ç°è®¾è®¡ è¿™é‡Œå…ˆæ˜ç¡®ä¸€ä¸‹æ¦‚å¿µï¼Œå¯¹å¯åŠ¨ä¸€ä¸ªMRä»»åŠ¡ç§°ä¹‹ä¸ºJobï¼Œè€ŒMapä»»åŠ¡ã€Reduceä»»åŠ¡ç§°ä¸ºTaskã€‚åé¢éƒ½ç”¨è‹±æ–‡æ¥è¡¨ç¤ºã€‚ Coordinatorçš„è®¾è®¡ ä¸€ä¸ªCoordinatoréœ€è¦çŸ¥é“MR Jobå½“å‰éœ€è¦å¤„ç†çš„filesï¼Œå¹¶ä¸”æœ‰éœ€è¦å‡ ä¸ªReduceï¼ˆæ‰§è¡ŒMakeCoordinatorï¿½çš„æ—¶å€™ä¼šä¼ å…¥ï¼‰ã€‚\nç”±äºä¸€ä¸ªjobä¼šå­˜åœ¨mapã€Reduceé˜¶æ®µï¼Œè¿™é‡Œç»™jobè®¾è®¡äº†å‡ ä¸ªé˜¶æ®µï¼ˆçŠ¶æ€ï¼‰ï¼Œç”¨æ•´å‹æ¥è¡¨ç¤ºã€‚å¦‚ä¸‹\né˜¶æ®µ é˜¶æ®µå€¼ åˆå§‹é˜¶æ®µ 1 Mapé˜¶æ®µ 2 Reduceé˜¶æ®µ 3 ç­‰å¾…Workerä¸‹çº¿é˜¶æ®µ 4 jobç»“æŸ 5 Coordinatoréœ€è¦çŸ¥é“å½“å‰æœ‰å“ªäº›Workerå­˜åœ¨ï¼Œåˆ¤æ–­å…¶Workerçš„å­˜æ´»ï¼Œè¿›è€Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¿˜åœ¨ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥éœ€è¦ç”¨ä¸€ä¸ªç»“æ„ä½“æ¥è¡¨æ˜¯workerèŠ‚ç‚¹ï¼Œåˆ¤æ–­å­˜æ´»çš„ä¾æ®ç®€å•çš„å¿ƒè·³å¤„ç†ã€‚\nCoordinatoréœ€è¦æ¨è¿›mapã€reduceä»»åŠ¡çš„æ‰§è¡Œï¼Œéœ€è¦ç»´æŠ¤taskåˆ—è¡¨ã€‚ï¼ˆå…·ä½“taskçš„è®¾è®¡çœ‹ä¸‹é¢ï¼‰è¿™é‡Œåˆ†åˆ«ä¸ºä¸¤ç§ç±»å‹çš„taskè®¾ç«‹ä¸¤ä¸ªåˆ—è¡¨ï¼Œä½¿ç”¨mapå­˜æ”¾ã€‚\nå› ä¸ºæ‰§è¡Œå®Œmapä»»åŠ¡åï¼Œæ‰å¯ä»¥æ‰§è¡Œreduceä»»åŠ¡ï¼Œè¿™é‡Œç®€å•èµ·è§ï¼Œåˆ¤æ–­å„ä¸ªé˜¶æ®µä»»åŠ¡å®Œæˆçš„æ ‡è®°ä½¿ç”¨è®¡æ•°æ¥è¡¨ç¤ºã€‚æ‰€ä»¥è€Œå¤–éœ€è¦ä¸¤ä¸ªç»Ÿè®¡æ•°å€¼ï¼šmapä»»åŠ¡å®Œæˆæ•°é‡ã€reduceä»»åŠ¡å®Œæˆæ•°é‡ã€‚\nå¤šä¸ªWorkerè¯·æ±‚ï¼Œéœ€è¦å¹¶å‘ä¿®æ”¹taskç»“æ„ä½“çš„çŠ¶æ€ä»¥åŠç»Ÿè®¡ä»»åŠ¡æ•°ç­‰ï¼Œä¼šéœ€è¦äº’æ–¥è®¿é—®ï¼Œè¿˜éœ€è¦ä¸€ä¸ªmutexè¿›è¡Œæ•°æ®ä¿æŠ¤ã€‚\næ€»ç»“ä¸Šè¿°ï¼Œä¸€ä¸ªCoordinatorå†…åŒ…å«çš„ç»“æ„å¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 type Coordinator struct { // Your definitions here. files []string reduceNum int jobStage int workerNodeMap map[int]*workerNode mapTaskMap map[int]*TaskResult reduceTaskMap map[int]*TaskResult mapTaskDoneCount int reduceTaskDoneCount int taskMutex sync.Mutex } type workerNode struct { workerId int lastHeartBeatTime int64 } const JOB_STAGE_INIT = 1 const JOB_MAP_STAGE = 2 const JOB_REDUCE_STAGE = 3 const JOB_END = 5 const MAP_TASK = \u0026#34;map\u0026#34; const REDUCE_TASK = \u0026#34;reduce\u0026#34; Taskçš„è®¾è®¡ mapTaskã€reduceTaskéƒ½æœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§ï¼Œå¤–å‡ºæ¥çœ‹éƒ½æ˜¯è¾“å…¥ã€è¾“å‡ºã€‚æ‰€ä»¥è¿™é‡Œè®¾è®¡éƒ½ä½¿ç”¨åŒä¸€ä¸ªç»“æ„ä½“æ¥è¡¨ç¤ºä¸¤ç§é˜¶æ®µçš„ä»»åŠ¡ã€‚ä½¿ç”¨ä¸€ä¸ªtypeå­—æ®µè¿›è¡ŒåŒºåˆ†å³å¯ã€‚è¿™é‡Œä¹Ÿç»™taskè¿›è¡Œäº†çŠ¶æ€çš„åˆ’åˆ†ã€‚ï¼ˆè¿™é‡Œå‡è®¾taskæ²¡æœ‰å¤±è´¥çš„å¯èƒ½ï¼‰ã€‚\né˜¶æ®µ é˜¶æ®µå€¼ å¾…æ‰§è¡Œ 1 æ‰§è¡Œä¸­ 2 æ‰§è¡Œå®Œæˆ 3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 const TASK_PENDING = 1 const TASK_EXECUTING = 2 const TASK_COMPLETED = 3 type TaskResult struct { TaskId int // ç”±Coordinatorè¿›è¡Œåˆ†é… TaskType string // map or reduce Status int FilePath []string // input file path ResultPath []string // output file path ExecuteSuccess bool // execute result WorkerId int // execute worker NReduce int StartExecuteTime int64 } type HeartbeatResult struct { WorkerId int Shutdown bool // å½“trueæ—¶ç›´æ¥é€€å‡ºè¿›ç¨‹ } Workerçš„è®¾è®¡ workeræ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯å’ŒCoordinatorè¿›è¡Œé€šä¿¡ï¼Œæ‰§è¡Œmapã€reduceä»»åŠ¡ã€‚\nç”±äºmapã€reduceç±»å‹çš„taskéƒ½æ˜¯workeræ‰§è¡Œï¼Œä¸­é—´æ–‡ä»¶çš„å¤„ç†ä¹Ÿè½åˆ°äº†workerèº«ä¸Šã€‚ä¸‹é¢æ˜¯å¤„ç†å„ä¸ªé˜¶æ®µçš„é€»è¾‘\nmapé˜¶æ®µï¼šworkerä¼šæ ¹æ®reduceçš„æ•°é‡nï¼Œåˆ›å»ºnä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶å°†mapäº§ç”Ÿçš„kvç»“æœï¼Œåˆ†æ•£å†™å…¥åˆ°è¿™nä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ä¹‹åï¼Œå°†è¿™nä¸ªä¸´æ—¶æ–‡ä»¶è·¯å¾„ä½œä¸ºå½“å‰mapä»»åŠ¡çš„ResultPathï¼Œä¸ŠæŠ¥ç»™Coordinatorã€‚ Coordinatoråè°ƒé˜¶æ®µï¼šå°†mapäº§å‡ºçš„ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥åˆ°å¯¹åº”çš„Reduceä»»åŠ¡çš„FilePathä¸­ä½œä¸ºè¾“å…¥ reduceé˜¶æ®µï¼šworkerè¯»å–æ‰€æœ‰FilePathä¸­çš„æ–‡ä»¶åï¼Œåšä¸€ä¸ªsortã€mergeï¼Œæ‰§è¡ŒReduceå‡½æ•°ã€‚å°†äº§å‡ºå†™å…¥åˆ°mr-out-taskIdçš„æ–‡ä»¶ä¸­ï¼ˆè¿™é‡Œç®€å•èµ·è§ï¼Œä¸å†™å…¥tmp fileäº†ï¼‰ è¿™é‡Œå’Œå®éªŒæ¨èçš„ä¸€æ ·ï¼Œå°†mapç”Ÿæˆçš„ä¸­é—´KVæ•°æ®ä½œä¸ºjsonç»“æ„å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ RPCé€šä¿¡è®¾è®¡ Coordinatorå’Œworkerä¹‹é—´ï¼Œæ˜¯é‡‡ç”¨ä¸æ–­è¯·æ±‚çš„æ¨¡å¼ï¼ˆpullï¼‰ã€‚Coordinatorä¸ä¼šä¸»åŠ¨ç»™workerå‘é€æ•°æ®ã€‚\nè¿™é‡Œè®¾è®¡äº†ä¸‰ç§çš„æ¥å£äº¤äº’\nworkerå®šæ—¶ä¸ŠæŠ¥å¿ƒè·³ç»™Coordinator workerä¸æ–­åœ°ä»Coordinatorä¸­è·å–ä»»åŠ¡æ‰§è¡Œ workeræ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡åï¼Œä¸ŠæŠ¥æ‰§è¡Œç»“æœç»™Coordinator åŸºæœ¬å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nè¾ƒé‡è¦çš„å®šæ—¶ä»»åŠ¡ å®šæ—¶ä»»åŠ¡ä¸»è¦æ˜¯è§£å†³Workerè·å–åˆ°ä»»åŠ¡åï¼Œä½†æ˜¯Workerå®•æœºçš„æƒ…å†µï¼Œè¿™æ—¶å€™Workeræ‰§è¡Œçš„taskéœ€è¦äº¤ç»™å…¶ä»–Workerå»æ‰§è¡Œã€‚\nè®¾è®¡ä¸Šï¼Œé€šè¿‡åˆ¤å®šWorkerçš„å¿ƒè·³è¶…æ—¶æ—¶é—´æ¥åˆ¤å®šWorkeræ˜¯å¦å®•æœºï¼Œä»¥åŠæŒ‰ç…§å®éªŒé¦–é¡µè¯´çš„ï¼Œç®€å•çš„åˆ¤æ–­å¦‚æœtaskæ‰§è¡Œæ—¶é—´è¶…è¿‡äº†10sï¼Œä¹Ÿè®¤ä¸ºè¯¥ä»»åŠ¡éœ€è¦åˆ‡æ¢Workeræ‰§è¡Œã€‚\nä¸‹é¢æ˜¯Coordinatorçš„ä¸¤ä¸ªå®šæ—¶ä»»åŠ¡é€»è¾‘\næ‰«æWorkeråˆ—è¡¨ï¼Œå¦‚æœä¸Šä¸€æ¬¡å¿ƒè·³æ—¶é—´è¶…è¿‡äº†é¢„å®šçš„è¶…æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆå°±ä»Workeråˆ—è¡¨ä¸­å‰”é™¤ æ‰«ætaskåˆ—è¡¨ï¼Œä»»åŠ¡å¤„äºæ­£åœ¨æ‰§è¡Œä¸­ï¼Œå¦‚æœå…¶æ‰§è¡Œçš„Workerå¹¶ä¸åœ¨Workerçš„åˆ—è¡¨ä¸­ï¼Œæˆ–è€…æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†10sï¼Œåˆ™é‡ç½®è¯¥ä»»åŠ¡ä¸ºå¾…æ‰§è¡ŒçŠ¶æ€ è¿™æ ·å°±å¯ä»¥é‡ç½®Taskçš„çŠ¶æ€ï¼Œå­˜æ´»çš„Workerå°±å¯ä»¥è·å–å¾—åˆ°Taskæ‰§è¡Œã€‚\nCoordinatoræ‰§è¡Œé˜¶æ®µæ¨è¿› åœ¨æ‰§è¡Œå®Œæ‰€æœ‰çš„Mapä»»åŠ¡ä¹‹åï¼Œæ‰å¯ä»¥æ‰§è¡ŒReduceä»»åŠ¡ã€‚è®¾è®¡ä¸Šï¼Œå°†ä»»åŠ¡æ¨è¿›æ”¾åˆ°äº†Coordinatorä¸­æ¥å—ä»»åŠ¡æ‰§è¡Œç»“æœçš„é€»è¾‘ä¸­ã€‚å¦‚æœæ‰€æœ‰çš„Mapä»»åŠ¡æ‰§è¡Œå®Œæˆäº†ï¼Œé‚£ä¹ˆå°±å°†JOB_STAGEä¿®æ”¹æˆReduceé˜¶æ®µï¼Œè¿™æ ·Workerå°±å¯ä»¥è·å–åˆ°Reduceä»»åŠ¡å»æ‰§è¡Œã€‚\nåªæœ‰CoordinatorçŸ¥é“æ•´ä½“çš„å®Œæˆæƒ…å†µï¼Œä½†æ˜¯Workerä¸çŸ¥é“ã€‚Workerå¯ä»¥ç®€å•çš„è®¾è®¡ä¸ºå¦‚æœRPCè°ƒç”¨å¤±è´¥ï¼Œå°±è®¤ä¸ºCoordinatorç»“æŸäº†ï¼Œè‡ªå·±ä¹Ÿè·Ÿç€é€€å‡ºã€‚æˆ–è€…æœ‰æŸç§RPCç»“æœèƒ½è®©WorkerçŸ¥é“å½“å‰éœ€è¦é€€å‡ºã€‚\nè¿™é‡Œè®¾è®¡é€šè¿‡Workerçš„å¿ƒè·³è¿”å›ç»“æœæ¥å‘ŠçŸ¥Workerä¸‹ä¸€æ­¥çš„æ‰§è¡Œï¼Œå¦‚æœæ”¶åˆ°shutdownå‘½ä»¤ï¼Œé‚£ä¹ˆå°±ç›´æ¥é€€å‡ºã€‚Coordinatoråœ¨Reduceé˜¶æ®µç»“æŸï¼Œå°±ç›´æ¥èµ°åˆ°endé˜¶æ®µã€‚\nè¸©å‘ å¯¹äºgoè¯­è¨€ä¸å¤ªç†Ÿç»ƒï¼Œä¸€äº›å¸¸è§çš„å‘è¸©äº†ä¸å°‘\nåˆ‡ç‰‡sliceã€å“ˆå¸Œè¡¨mapçš„éå†ä¿®æ”¹ã€åˆ é™¤å…ƒç´  goå†…ç½®rpcä½¿ç”¨ï¼Œå¯¹äºé»˜è®¤å€¼æ˜¯å¦‚ä½•å¤„ç†çš„ï¼ˆè¿™é‡Œå¯¹äºå„ç§çŠ¶æ€ï¼Œå»ºè®®é¿å¼€é»˜è®¤å€¼ï¼‰ è¿™é‡Œæœ‰ä¸ªå‘è°ƒè¯•äº†å¾ˆä¹…ï¼Œå°±æ˜¯workeråœ¨å»è¯·æ±‚ä»»åŠ¡çš„æ—¶å€™ï¼Œåˆ›å»ºçš„TaskResultç»“æ„ä½“æ˜¯æ”¾åœ¨äº†forå¾ªç¯å¤–è¾¹ï¼Œå¯¼è‡´åœ¨å¯¼è‡´æ¯æ¬¡è°ƒç”¨è·å–åˆ°çš„ç»“æœä¼šæºæ‚äº†ä¸Šæ¬¡è°ƒç”¨çš„ç»“æœğŸ˜­ï¼Œè¿˜æœ‰é»˜è®¤å€¼ä¸ä¿®æ”¹çš„é—®é¢˜ã€‚\nä¸‹é¢æ”¾ç‚¹ä»£ç ç¤ºä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func getTaskFromCoordinator(workerId int) TaskResult { // é—®é¢˜å°±åœ¨è¿™é‡Œï¼Œåªåˆ›å»ºäº†ä¸€æ¬¡ï¼Œå†…éƒ¨forå¾ªç¯ä¼šå…±ç”¨ä¸€ä¸ªå®ä¾‹ï¼Œå¤šæ¬¡è¯·æ±‚å’Œæºæ‚ä¸Šä¸€æ¬¡è¯·æ±‚çš„ç»“æœ // result := \u0026amp;TaskResult{} for { // æ­£ç¡®åº”è¯¥æ”¾åœ¨å¾ªç¯é‡Œè¾¹ result := \u0026amp;TaskResult{} ok := call(\u0026#34;Coordinator.GetTaskToExecute\u0026#34;, \u0026amp;workerId, result) if ok { if result.TaskId \u0026gt; -1 { return *result } time.Sleep(time.Second * 2) } else { log.Fatal(\u0026#34;è·å–ä»»åŠ¡å¤±è´¥\u0026#34;) } } } å¯¼è‡´çš„ç»“æœå°±æ˜¯å¦‚ä¸‹ï¼Œæ˜æ˜Coordinatorè¿”å›çš„taskIdæ˜¯0ï¼Œä¸ºå•¥workeræ”¶åˆ°çš„taskIdæ˜¯-1ï¼Ÿï¼Ÿï¼Ÿ\nåŸå› å°±æ˜¯ä¸Šä¸€æ¬¡è¯·æ±‚çš„ç»“æœè¿”å›çš„å°±æ˜¯-1ï¼Œè¿™ä¸€æ¬¡è¿”å›çš„æ˜¯0ï¼Œæ˜¯ä¸ªé»˜è®¤å€¼ï¼Œgoçš„rpcæ˜¯ä¸ä¼šä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå»ä¿®æ”¹-1ï¼ŒçœŸæ˜¯æ—¥äº†ç‹—ã€‚æ‰€ä»¥è¿™é‡Œå»ºè®®å¯¹äºå„ç§çŠ¶æ€ã€idå€¼çš„å®šä¹‰ä¸è¦ä½¿ç”¨é»˜è®¤å€¼ï¼ï¼ï¼\næ€»ç»“ è¿™é‡Œæ˜¯å‡è®¾æ‰€æœ‰çš„Taskæœ€ç»ˆåœ¨10så†…éƒ½æ˜¯ä¼šæ‰§è¡Œå®Œæˆçš„ï¼Œ10sæœªå®Œæˆåˆ™äº¤ç»™åˆ«çš„Workerå»æ‰§è¡Œã€‚å®é™…ä¸Šï¼ŒTaskçš„æ‰§è¡Œæ˜¯ä¼šå‡ºç°å„ç§å„æ ·çš„æƒ…å†µçš„ã€‚è€Œä¸”ï¼Œè¿™é‡Œè®¾è®¡ä¸Šæ¯ä¸€ä¸ªè¾“å…¥çš„fileä½œä¸ºä¸€ä¸ªMapä»»åŠ¡ï¼Œä¼šå‡ºç°è®¡ç®—å€¾æ–œçš„æƒ…å†µã€‚ç†æƒ³æƒ…å†µä¸‹éœ€è¦å¹³å‡çš„è¿›è¡Œåˆ‡åˆ†æ•°æ®ï¼Œè®©æ¯ä¸ªMapä»»åŠ¡å°½å¯èƒ½çš„å¤„ç†ç›¸åŒå¤§å°çš„æ•°æ®ã€‚\né¦–æ¬¡æ¥è§¦goè¯­è¨€æ¥å†™é¡¹ç›®ï¼Œä¸ä¼šçš„å°±è¾¹æœç´¢åˆ«å†™ï¼Œæ•ˆç‡åæ…¢äº›ï¼ŒdebugåŠå¤©ã€‚ä¸è¿‡ä¸»è¦æ˜¯è¦åœ¨å…³é”®èŠ‚ç‚¹è¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼Œä¾¿äºè§‚å¯Ÿå„ç§æ•°æ®ç»“æ„çš„å…·ä½“å˜æ›´æƒ…å†µã€‚\né™„å½• è¯¾ç¨‹é¦–é¡µï¼šhttps://pdos.csail.mit.edu/6.824/index.html\nè¯¾ç¨‹å®éªŒè¯´æ˜ï¼šhttps://pdos.csail.mit.edu/6.824/labs/lab-mr.html\nå‚è€ƒ ","date":"2024-03-24T21:37:07+08:00","image":"https://gloryjie.github.io/p/mit6824_lab1/cover_hu4faae92f089e584f7c8e1fb189bc7c34_1938005_120x120_fill_box_smart1_3.png","permalink":"https://gloryjie.github.io/p/mit6824_lab1/","title":"MIT6824å®éªŒ1-MapReduceè®¾è®¡"},{"content":" å°é¢å£çº¸ä¸ºå›½æ¼«ã€Šä»™é€†ã€‹çš„å¥³ä¸» ææ…•å©‰\nå°„çº¿æ³•ç®€ä»‹ å°„çº¿æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯é‡ç›®æ ‡ç‚¹å‘ä¸€ä¸ªæ–¹å‘å¼•å‡ºä¸€æ¡æ— é™çš„å°„çº¿æ³•ï¼Œç»Ÿè®¡å°„çº¿ä¸å¤šè¾¹å½¢çš„è¾¹ç›¸äº¤çš„æ•°é‡\nå¦‚æœæ˜¯å¶æ•°ï¼Œåˆ™ç‚¹åœ¨å¤šè¾¹å½¢å¤– å¦‚æœæ˜¯å¥‡æ•°ï¼Œåˆ™ç‚¹åœ¨å¤šè¾¹å½¢å†… ä¸€èˆ¬å°„çº¿çš„æ–¹å‘æ˜¯xè½´çš„æ­£æ•°æ–¹å‘ã€‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œnä¸ºå¤šè¾¹å½¢çš„è¾¹ï¼ˆç‚¹ï¼‰æ•°ã€‚\næƒ…å†µåˆ—ä¸¾å’Œåˆ†äº« ä¸‹é¢å‡ ç§æƒ…å†µéƒ½ç®—æ˜¯ç‚¹åœ¨å¤šè¾¹å½¢å†…\nç‚¹åœ¨å¤šè¾¹å½¢å†… ç‚¹å’Œå¤šè¾¹å½¢çš„é¡¶ç‚¹é‡å  ç‚¹åœ¨å¤šè¾¹å½¢çš„è¾¹ä¸Š å°„çº¿æ³•å°†åˆ¤æ–­åœ¨å¤šè¾¹å½¢å†…ï¼Œè½¬ç§»ä¸ºåˆ¤æ–­ç‚¹å’Œè¾¹çš„å…³ç³»ã€‚æ‰€ä»¥ç®—æ³•çš„ä¸»è¦é€»è¾‘ï¼Œå°±æ˜¯åœ¨åˆ¤æ–­ç‚¹å°„çº¿å’Œè¾¹çš„ç©ºé—´å…³ç³»ã€‚æœ‰ä¸¤ç§æƒ…å†µéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚\nå°„çº¿ç»è¿‡è¾¹çš„é¡¶ç‚¹ åˆ¤æ–­ç‚¹åœ¨æ–œçº¿çš„å·¦ä¾§çš„ä¸‰è§’å‡½æ•° ä»ç‚¹å¼•å‡ºçš„å°„çº¿å’Œå¤šè¾¹å½¢çš„è¾¹æœ‰ä¸‹é¢å‡ ç§æƒ…å†µéœ€è¦è€ƒè™‘\nç‚¹åœ¨åœ¨è¾¹çš„ä¸Šæ–¹ã€ä¸‹æ–¹ã€å³ä¾§ï¼Œä¸ä¼šç›¸äº¤ è¾¹æ°´å¹³çš„æƒ…å†µï¼Œä¸åˆ¤æ–­äº¤ç‚¹æ•°ï¼Œåªåˆ¤æ–­æ˜¯å¦åœ¨çº¿ä¸Š å°„çº¿ç»è¿‡è¾¹çš„é¡¶ç‚¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨æƒé‡å€¼æ¥è§£å†³ç»è¿‡é¡¶ç‚¹çš„é—®é¢˜ï¼ˆæ¶µç›–äº†è¾¹å‚ç›´çš„æƒ…å†µï¼‰ Bç‚¹åœ¨Aç‚¹çš„ä¸‹æ–¹ï¼Œé‚£ä¹ˆæƒé‡å€¼-0.5 Bç‚¹åœ¨Aç‚¹çš„ä¸Šæ–¹ï¼Œé‚£ä¹ˆæƒé‡å€¼+0.5 è¾¹å‚ç›´çš„æƒ…å†µ ç‚¹åœ¨å‚ç›´çš„è¾¹Pä¸Šï¼Œåˆ™ç‚¹åœ¨å¤šè¾¹å½¢å†… ç‚¹åœ¨åœ¨å‚ç›´çš„è¾¹çš„å·¦è¾¹ï¼Œåˆ™ç‚¹ä¸è¯¥è¾¹å¿…ç„¶æœ‰äº¤ç‚¹ è¾¹æ–œçº¿çš„æƒ…å†µ ç‚¹åœ¨çº¿çš„å·¦è¾¹ï¼Œè‚¯å®šä¼šæœ‰äº¤ç‚¹ é€šè¿‡ä¸‰è§’å‡½æ•°æ¥åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨è¾¹çš„å·¦è¾¹ å„ç§æƒ…å†µçš„åˆ¤æ–­ä»£ç  ç‚¹çš„è¡¨è¾¾\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Data @AllArgsConstructor @NoArgsConstructor public class Point { /** * ç»åº¦ */ private Double lng; /** * çº¬åº¦ */ private Double lat; } ç›®æ ‡ç‚¹å’Œå¤šè¾¹å½¢çš„é¡¶ç‚¹é‡åˆ\n1 2 3 4 5 6 // é¡¶ç‚¹é‡åˆçš„æƒ…å†µ for (Point polygonPoint : polygonPoints) { if (Objects.equals(target, polygonPoint)) { return true; } } ç‚¹åœ¨çš„ä¸Šæ–¹ã€ä¸‹æ–¹ã€å³ä¾§ï¼Œå°„çº¿è‚¯å®šä¸ä¼šå’Œè¾¹ç›¸äº¤\n1 2 3 4 if (target.getLat() \u0026lt; minLat || target.getLat() \u0026gt; maxLat || target.getLng() \u0026gt; maxLng) { pointA = pointB; continue; } è¾¹æ°´å¹³çš„æƒ…å†µ,è‹¥ç‚¹åœ¨æ°´å¹³çš„è¾¹ä¸Šï¼Œåˆ™ç‚¹åœ¨å¤šè¾¹å½¢å†…ã€‚å¹³è¡Œé‡å çš„æƒ…å†µï¼Œä¸åšäº¤ç‚¹æ•°åˆ¤æ–­ã€‚\n1 2 3 4 5 6 7 if (Objects.equals(pointA.getLat(), pointB.getLat())) { if (target.getLng() \u0026lt;= maxLng \u0026amp;\u0026amp; target.getLng() \u0026gt;= minLng) { return true; } pointA = pointB; continue; } å°„çº¿ç»è¿‡è¾¹çš„é¡¶ç‚¹(æ­¤æ—¶è¾¹å¯èƒ½å‚ç›´)ï¼Œè§£å†³æ–¹æ¡ˆä¸ºï¼šå¦‚æœäº¤ç‚¹æ˜¯å¾…æµ‹å¤šè¾¹å½¢æŸä¸ªè¾¹ä¸Šçš„ä¸€ä¸ªé¡¶ç‚¹ï¼Œåˆ™åªæœ‰å½“è¯¥è¾¹çš„å¦ä¸€ä¸ªé¡¶ç‚¹ä½äºå°„çº¿ä¸‹æ–¹æ—¶ï¼Œäº¤ç‚¹æ‰ç®—åœ¨å†…ã€‚è¿™å®é™…ä¸Šç­‰åŒäºå°†ä¸å°„çº¿ç›¸äº¤çš„é¡¶ç‚¹è§†ä¸ºç•¥é«˜äºå°„çº¿ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 if ((Objects.equals(target.getLat(), pointA.getLat()) \u0026amp;\u0026amp; target.getLng() \u0026lt; pointA.getLng()) || Objects.equals(target.getLat(), pointB.getLat()) \u0026amp;\u0026amp; target.getLng() \u0026lt; pointB.getLng()) { if (pointB.getLat() \u0026lt; pointA.getLat()) { // Bç‚¹åœ¨Aç‚¹çš„ä¸‹æ–¹ï¼Œé‚£ä¹ˆæƒé‡å€¼-0.5 intersectPointWeights -= 0.5; } else if (pointB.getLat() \u0026gt; pointA.getLat()) { // Bç‚¹åœ¨Aç‚¹çš„ä¸Šæ–¹ï¼Œé‚£ä¹ˆæƒé‡å€¼+0.5 intersectPointWeights += 0.5; } pointA = pointB; continue; } è¾¹å‚ç›´çš„æƒ…å†µ\n1 2 3 4 5 6 7 8 9 10 11 12 if (Objects.equals(pointA.getLng(), pointB.getLng())) { if (Objects.equals(target.getLng(), pointA.getLng())) { // è‹¥ç‚¹åœ¨å‚ç›´çš„è¾¹Pä¸Šï¼Œåˆ™ç‚¹åœ¨å¤šè¾¹å½¢å†… return true; } else if (target.getLng() \u0026lt; pointA.getLng()) { // è‹¥ç‚¹åœ¨åœ¨å‚ç›´çš„è¾¹çš„å·¦è¾¹ï¼Œåˆ™ç‚¹ä¸è¯¥è¾¹å¿…ç„¶æœ‰äº¤ç‚¹ intersectPointCount++; } pointA = pointB; continue; } è¾¹æ–œçº¿çš„æƒ…å†µï¼Œä½¿ç”¨ä¸‰è§’å‡½æ•°æ¥åˆ¤æ–­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 if (target.getLng() \u0026lt;= minLng) { // ç‚¹pointçš„xåæ ‡åœ¨è¾¹çš„å·¦ä¾§ï¼Œé‚£ä¹ˆè‚¯å®šç›¸äº¤ intersectPointCount++; } else if (target.getLng() \u0026lt; maxLng) { // ç‚¹pointçš„xåæ ‡åœ¨ç‚¹Bã€Açš„xåæ ‡ä¸­é—´ double diff = (target.getLat() - pointA.getLat()) * (pointA.getLng() - pointB.getLng()) / (pointA.getLat() - pointB.getLat()) + pointA.getLng() - target.getLng(); if (diff \u0026gt;= 0) { if (diff \u0026lt; PRECISION) { // ç”±äºdoubleç²¾åº¦åœ¨è®¡ç®—æ—¶ä¼šæœ‰æŸå¤±ï¼Œæ•…åŒ¹é…ä¸€å®šçš„å®¹å·® // ç‚¹åœ¨æ–œçº¿P1P2ä¸Š return true; } else { // ç‚¹å‘å³å°„çº¿ä¸æ–œçº¿P1P2æœ‰äº¤ç‚¹ intersectPointCount++; } } } æµ‹è¯•ç¤ºä¾‹ å›¾å½¢å¦‚ä¸‹\nç‚¹é›†åˆï¼Œä¹Ÿå°±æ˜¯å¤šè¾¹å½¢\n1 [{\u0026#34;lng\u0026#34;:110.269889,\u0026#34;lat\u0026#34;:21.308982},{\u0026#34;lng\u0026#34;:110.277883,\u0026#34;lat\u0026#34;:21.231378},{\u0026#34;lng\u0026#34;:110.275219,\u0026#34;lat\u0026#34;:21.178585},{\u0026#34;lng\u0026#34;:110.309195,\u0026#34;lat\u0026#34;:21.166692},{\u0026#34;lng\u0026#34;:110.345361,\u0026#34;lat\u0026#34;:21.166692},{\u0026#34;lng\u0026#34;:110.345361,\u0026#34;lat\u0026#34;:21.225846},{\u0026#34;lng\u0026#34;:110.37871,\u0026#34;lat\u0026#34;:21.218632},{\u0026#34;lng\u0026#34;:110.416809,\u0026#34;lat\u0026#34;:21.210863},{\u0026#34;lng\u0026#34;:110.41919,\u0026#34;lat\u0026#34;:21.224181},{\u0026#34;lng\u0026#34;:110.419648,\u0026#34;lat\u0026#34;:21.234822},{\u0026#34;lng\u0026#34;:110.385148,\u0026#34;lat\u0026#34;:21.282747},{\u0026#34;lng\u0026#34;:110.351299,\u0026#34;lat\u0026#34;:21.286387},{\u0026#34;lng\u0026#34;:110.269889,\u0026#34;lat\u0026#34;:21.308982}] æµ‹è¯•ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 System.out.println(\u0026#34;å›¾å½¢å¤–ï¼Œå°„çº¿å’Œçº¿æ°´å¹³ï¼Œä¸åœ¨çº¿ä¸Šï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.301195,21.166692), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å†…, å°„çº¿å’Œçº¿æ°´å¹³ï¼Œåœ¨çº¿ä¸Šï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.319195,21.166692), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å†…ï¼Œå°„çº¿å’Œçº¿å‚ç›´ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.319195,21.186692), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å¤–ï¼Œå°„çº¿å’Œçº¿å‚ç›´ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.219195,21.186692), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å†…ï¼Œç»è¿‡çº¿é¡¶ç‚¹ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.305361,21.225846), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å¤–ï¼Œç»è¿‡çº¿é¡¶ç‚¹ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.245361,21.225846), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å†…ï¼Œå’Œä¸€æ¡æ–œçº¿ç›¸äº¤ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.305361,21.265846), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å¤–ï¼Œå’Œä¸€æ¡æ–œçº¿ç›¸äº¤ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.245361,21.265846), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å†…ï¼Œå’Œå¤šæ¡çº¿ç›¸äº¤ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.305361,21.221846), polygonPointList)); System.out.println(\u0026#34;å›¾å½¢å¤–ï¼Œå’Œå¤šæ¡çº¿ç›¸äº¤ï¼š\u0026#34; + RayCastUtil.isPointInPolygon(new Point(110.245361,21.221846), polygonPointList)); å®Œæ•´ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 public class RayCastUtil { private static final double PRECISION = 2e-10; public static boolean isPointInPolygon(Point target, List\u0026lt;Point\u0026gt; polygonPoints) { // è¿™é‡Œä¸éœ€è¦é¦–å°¾ç›¸è¿ï¼Œæœ‰äº›ä¸éœ€è¦ï¼Œè¿™å°± if (Objects.equals(polygonPoints.get(0), polygonPoints.get(polygonPoints.size() - 1))) { polygonPoints = polygonPoints.subList(0, polygonPoints.size() - 1); } // é¡¶ç‚¹é‡åˆçš„æƒ…å†µ for (Point polygonPoint : polygonPoints) { if (Objects.equals(target, polygonPoint)) { return true; } } // Xè½´å°„çº¿ä¸å¤šè¾¹å½¢çš„äº¤ç‚¹æ•° int intersectPointCount = 0; // Xè½´å°„çº¿ä¸å¤šè¾¹å½¢é¡¶ç‚¹ç›¸äº¤çš„æƒå€¼ double intersectPointWeights = 0; // pointA -\u0026gt; pointB ä»£è¡¨ä¸€æ¡è¾¹ Point pointA = polygonPoints.get(0); Point pointB = null; final int pointSize = polygonPoints.size(); for (int i = 1; i \u0026lt;= pointSize; i++) { // forä¸­å®šä¹‰\u0026lt;=ä»¥åŠè¿™é‡Œçš„%å–ä½™ï¼Œæ˜¯ä¸ºäº†å…³æ³¨æœ€åä¸€ä¸ªèŠ‚ç‚¹è¿æ¥é¦–èŠ‚ç‚¹è¿™æ¡è¾¹çš„æƒ…å†µ pointB = polygonPoints.get(i % pointSize); double minLat = Math.min(pointA.getLat(), pointB.getLat()); double maxLat = Math.max(pointA.getLat(), pointB.getLat()); double minLng = Math.min(pointA.getLng(), pointB.getLng()); double maxLng = Math.max(pointA.getLng(), pointB.getLng()); // ç›®æ ‡ç‚¹åœ¨çš„ä¸Šæ–¹ã€ä¸‹æ–¹ã€å³ä¾§ï¼Œé‚£ä¹ˆå°±ä¸ä¼šç›¸äº¤ if (target.getLat() \u0026lt; minLat || target.getLat() \u0026gt; maxLat || target.getLng() \u0026gt; maxLng) { pointA = pointB; continue; } // è¾¹æ°´å¹³çš„æƒ…å†µ,è‹¥ç‚¹åœ¨æ°´å¹³çš„è¾¹ä¸Šï¼Œåˆ™ç‚¹åœ¨å¤šè¾¹å½¢å†…, if (Objects.equals(pointA.getLat(), pointB.getLat())) { if (target.getLng() \u0026lt;= maxLng \u0026amp;\u0026amp; target.getLng() \u0026gt;= minLng) { return true; } pointA = pointB; continue; } // è¾¹ç•Œå¤„ç†ï¼šå°„çº¿ç»è¿‡è¾¹çš„é¡¶ç‚¹(æ­¤æ—¶è¾¹å¯èƒ½å‚ç›´) if ((Objects.equals(target.getLat(), pointA.getLat()) \u0026amp;\u0026amp; target.getLng() \u0026lt; pointA.getLng()) || Objects.equals(target.getLat(), pointB.getLat()) \u0026amp;\u0026amp; target.getLng() \u0026lt; pointB.getLng()) { if (pointB.getLat() \u0026lt; pointA.getLat()) { // Bç‚¹åœ¨Aç‚¹çš„ä¸‹æ–¹ï¼Œé‚£ä¹ˆæƒé‡å€¼-0.5 intersectPointWeights -= 0.5; } else if (pointB.getLat() \u0026gt; pointA.getLat()) { // Bç‚¹åœ¨Aç‚¹çš„ä¸Šæ–¹ï¼Œé‚£ä¹ˆæƒé‡å€¼+0.5 intersectPointWeights += 0.5; } pointA = pointB; continue; } // è¾¹å‚ç›´çš„æƒ…å†µ if (Objects.equals(pointA.getLng(), pointB.getLng())) { if (Objects.equals(target.getLng(), pointA.getLng())) { // è‹¥ç‚¹åœ¨å‚ç›´çš„è¾¹Pä¸Šï¼Œåˆ™ç‚¹åœ¨å¤šè¾¹å½¢å†… return true; } else if (target.getLng() \u0026lt; pointA.getLng()) { // è‹¥ç‚¹åœ¨åœ¨å‚ç›´çš„è¾¹çš„å·¦è¾¹ï¼Œåˆ™ç‚¹ä¸è¯¥è¾¹å¿…ç„¶æœ‰äº¤ç‚¹ intersectPointCount++; } pointA = pointB; continue; } // è¾¹æ–œçš„æƒ…å†µ if (target.getLng() \u0026lt;= minLng) { // ç‚¹pointçš„xåæ ‡åœ¨è¾¹çš„å·¦ä¾§ï¼Œé‚£ä¹ˆè‚¯å®šç›¸äº¤ intersectPointCount++; } else if (target.getLng() \u0026lt; maxLng) { // ç‚¹pointçš„xåæ ‡åœ¨ç‚¹Bã€Açš„xåæ ‡ä¸­é—´ double diff = (target.getLat() - pointA.getLat()) * (pointA.getLng() - pointB.getLng()) / (pointA.getLat() - pointB.getLat()) + pointA.getLng() - target.getLng(); if (diff \u0026gt;= 0) { if (diff \u0026lt; PRECISION) { // ç”±äºdoubleç²¾åº¦åœ¨è®¡ç®—æ—¶ä¼šæœ‰æŸå¤±ï¼Œæ•…åŒ¹é…ä¸€å®šçš„å®¹å·® // ç‚¹åœ¨æ–œçº¿P1P2ä¸Š return true; } else { // ç‚¹å‘å³å°„çº¿ä¸æ–œçº¿P1P2æœ‰äº¤ç‚¹ intersectPointCount++; } } } pointA = pointB; } return (intersectPointCount + Math.abs(intersectPointWeights)) % 2 != 0; } } é™„å½• å‚è€ƒ YouTubeè§†é¢‘ï¼šChecking if a point is inside a polygon is RIDICULOUSLY simple (Ray casting algorithm) - Inside code\nåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…çš„Pythonå®ç°åŠå°åº”ç”¨ï¼ˆå°„çº¿æ³•ï¼‰\nç»´åŸºç™¾ç§‘ï¼šå¤šè¾¹å½¢å†…çš„ç‚¹\n","date":"2024-03-04T20:33:08+08:00","image":"https://gloryjie.github.io/p/%E5%B0%84%E7%BA%BF%E6%B3%95-%E5%88%A4%E6%96%AD%E7%82%B9%E6%98%AF%E5%90%A6%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%86%85/cover_hue2c682d0e4643ecbc5c998a202920083_1132640_120x120_fill_q75_box_smart1.jpeg","permalink":"https://gloryjie.github.io/p/%E5%B0%84%E7%BA%BF%E6%B3%95-%E5%88%A4%E6%96%AD%E7%82%B9%E6%98%AF%E5%90%A6%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%86%85/","title":"å°„çº¿æ³• åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…"},{"content":" 1 å°é¢æ˜¯ã€Šæ­»äº¡ææµ…ã€‹æ¸¸æˆä¸­çš„ ç›ç› å®˜æ–¹æœ‰æ•™ç¨‹ï¼šhttps://resilience4j.readme.io/v1.7.0/docs/getting-started-3\nè¿™é‡Œåšä¸ªç®€å•ä½¿ç”¨è®°å½•ã€‚ ç‰ˆæœ¬è¦æ±‚ Resilience4jç‰ˆæœ¬ JDKç‰ˆæœ¬ 1.7 8 2.0 17 è¿™é‡Œç”¨çš„jdk8ï¼Œä½¿ç”¨Resilience4jçš„1.7ç‰ˆæœ¬ã€‚mvnä¾èµ–å¦‚ä¸‹\n1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.github.resilience4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;resilience4j-spring-boot2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.7.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; è¿™ä¸ªåŒ…æŠŠResilience4jçš„åŸºæœ¬ç»„ä»¶éƒ½å¼•å…¥è¿›æ¥äº†ã€‚\nymlé…ç½® é…ç½®å¯ä»¥æœ‰ä¸‰ä¸ªå±‚çº§çš„é…ç½®ï¼Œåˆ†åˆ«å¯ä»¥ç»§æ‰¿ã€‚\nä¿®æ”¹é»˜è®¤é…ç½® è‡ªå®šä¹‰å¯å…±äº«çš„é…ç½® å®ä¾‹è‡ªå®šä¹‰é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 resilience4j.circuitbreaker: # æŒ‡å®šå¯¹åº”çš„ç»„ä»¶ configs: default: # ä¿®æ”¹é»˜è®¤é…ç½® slidingWindowSize: 100 permittedNumberOfCallsInHalfOpenState: 10 waitDurationInOpenState: 10000 failureRateThreshold: 60 eventConsumerBufferSize: 10 registerHealthIndicator: true someShared: # å¯å…±äº«çš„é…ç½® slidingWindowSize: 50 permittedNumberOfCallsInHalfOpenState: 10 instances: # ä¸‹é¢æ˜¯å®ä¾‹è‡ªå®šä¹‰é…ç½® backendA: # å®ä¾‹åç§° baseConfig: default # æŒ‡å®šç»§æ‰¿çš„é…ç½® waitDurationInOpenState: 5000 backendB: baseConfig: someShared äº‹ä»¶ç›‘å¬å™¨ Resilience4jæä¾›äº†ä¸¤ç§ç»†ç²’åº¦çš„æ—¶é—´ç›‘å¬\nRegistryç»„ä»¶çš„å¢ã€åˆ ã€æ›¿æ¢äº‹ä»¶ ç»„ä»¶å®ä¾‹çš„çŠ¶æ€å˜åŒ–äº‹ä»¶ Resilience4jåŸç”Ÿä½¿ç”¨æ—¶åœ¨å¯¹åº”ç»„ä»¶å®ä¾‹çš„åŸºç¡€ä¸Šå»è¿›è¡Œè®¾ç½®ç›‘å¬ï¼Œä½†æ˜¯ç»“åˆSpringBootä¹‹åæ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥æ‹¿åˆ°å¯¹åº”çš„ç»„ä»¶å®ä¾‹ã€‚å¯ä»¥é€šè¿‡ç›‘å¬å®ä¾‹çš„å¢ã€åˆ ã€æ›¿æ¢çš„åŠ¨ä½œï¼Œè¿›è€Œæ‹¿åˆ°å¯¹åº”çš„å®ä¾‹ï¼Œä¹‹åå†è¿›è¡Œç›‘å¬å®ä¾‹çŠ¶æ€çš„å˜æ›´ã€‚\nè‡ªå·±åˆ›å»ºçš„RegistryEventConsumerçš„Beanï¼Œä¼šè‡ªåŠ¨æ·»åŠ åˆ°SpringBootè‡ªèº«ç®¡ç†çš„CircuitBreakerRegistryä¸­ã€‚\nä»¥ç›‘å¬CircuitBreakerç»„ä»¶ä¸ºä¾‹ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼ˆIMessageServiceä¸ºè‡ªå·±çš„beanï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 @Bean public RegistryEventConsumer\u0026lt;CircuitBreaker\u0026gt; circuitBreakerEventConsumer(IMessageService messageService){ return new RegistryEventConsumer\u0026lt;CircuitBreaker\u0026gt;() { @Override public void onEntryAddedEvent(EntryAddedEvent\u0026lt;CircuitBreaker\u0026gt; entryAddedEvent) { entryAddedEvent.getAddedEntry().getEventPublisher().onStateTransition(event -\u0026gt; { String circuitBreakerName = event.getCircuitBreakerName(); CircuitBreaker.State fromState = event.getStateTransition().getFromState(); CircuitBreaker.State toState = event.getStateTransition().getToState(); log.info(\u0026#34;CircuitBreaker \u0026#39;{}\u0026#39; changed state from {} to {}\u0026#34;, circuitBreakerName, fromState, toState); StringBuilder builder = new StringBuilder(); builder.append(\u0026#34;\u0026lt;font color=\\\u0026#34;warning\\\u0026#34;\u0026gt;æ–­è·¯å™¨çŠ¶æ€å‘ç”Ÿå˜åŒ– \u0026#34;).append(DateUtil.now()).append(\u0026#34; \u0026lt;/font\u0026gt;\\n\u0026#34;); builder.append(\u0026#34;\u0026gt; æ–­è·¯å™¨åç§°ï¼š\u0026#34;).append(circuitBreakerName).append(\u0026#34;\\n\u0026#34;); builder.append(\u0026#34;\u0026gt; å˜åŒ–å‰çŠ¶æ€ï¼š\u0026#34;).append(fromState).append(\u0026#34;\\n\u0026#34;); builder.append(\u0026#34;\u0026gt; å˜åŒ–åçŠ¶æ€ï¼š\u0026#34;).append(toState).append(\u0026#34;\\n\u0026#34;); builder.append(\u0026#34;è¯·å°½å¿«å¤„ç†ï¼ï¼ï¼\u0026#34;); messageService.reportDefaultMsg(builder.toString()); }); } @Override public void onEntryRemovedEvent(EntryRemovedEvent\u0026lt;CircuitBreaker\u0026gt; entryRemoveEvent) { } @Override public void onEntryReplacedEvent(EntryReplacedEvent\u0026lt;CircuitBreaker\u0026gt; entryReplacedEvent) { } }; } ä½¿ç”¨å½¢å¼ æ³¨è§£ä½¿ç”¨ åªéœ€è¦åœ¨å¯¹åº”çš„æ–¹æ³•åŠ ä¸Šå¯¹åº”ç»„ä»¶çš„ç›´æ¥å³å¯ã€‚è¿˜å¯ä»¥åœ¨æ·»åŠ é™çº§å¤„ç†çš„æ–¹ï¼Œä¼šè‡ªåŠ¨æ ¹æ®å¼‚å¸¸ç±»å‹è¿›è¡Œæ‰¹é‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @CircuitBreaker(name = BACKEND, fallbackMethod = \u0026#34;fallback\u0026#34;) @RateLimiter(name = BACKEND) @Bulkhead(name = BACKEND, fallbackMethod = \u0026#34;fallback\u0026#34;) @Retry(name = BACKEND) @TimeLimiter(name = BACKEND) public Mono\u0026lt;String\u0026gt; method(String param1) { return Mono.error(new NumberFormatException()); } private Mono\u0026lt;String\u0026gt; fallback(String param1, CallNotPermittedException e) { return Mono.just(\u0026#34;Handled the exception when the CircuitBreaker is open\u0026#34;); } private Mono\u0026lt;String\u0026gt; fallback(String param1, BulkheadFullException e) { return Mono.just(\u0026#34;Handled the exception when the Bulkhead is full\u0026#34;); } private Mono\u0026lt;String\u0026gt; fallback(String param1, NumberFormatException e) { return Mono.just(\u0026#34;Handled the NumberFormatException\u0026#34;); } // å…¶å®ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªé€šç”¨çš„ï¼Œå†…éƒ¨if elseå¥½äº†ï¼Œå‡å°‘æ–¹æ³•çš„æ•°é‡ private Mono\u0026lt;String\u0026gt; fallback(String param1, Exception e) { return Mono.just(\u0026#34;Handled any other exception\u0026#34;); } ä»£ç ä½¿ç”¨ æ³¨è§£éƒ½æ˜¯åŸºäºAOPå»å¤„ç†çš„ï¼Œé€šç—…å°±æ˜¯è°ƒç”¨å†…éƒ¨æ–¹æ³•çš„æ—¶å€™æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚å¯ä»¥æ‰‹åŠ¨è·å–åˆ°å¯¹åº”çš„å®åŠ›ã€‚\n1 2 3 4 5 @Resource private CircuitBreakerRegistry circuitBreakerRegistry; // ä»registryè·å–å®ä¾‹ï¼Œå’Œæ³¨è§£ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹ circuitBreakerRegistry.circuitBreaker(\u0026#34;tencentAddressService\u0026#34;); starterçš„é…ç½®è¿‡ç¨‹ ç»“åˆSpringBootçš„starterï¼Œæµç¨‹åŸºæœ¬å°±æ˜¯è¯»å–é…ç½®ï¼Œåˆ›å»ºå„ç§Beanç»„ä»¶ã€‚æä¾›äº†å„ç§æ³¨è§£ï¼Œåˆ™è¿‡ç¨‹å°±æ˜¯åŸºäºAopå»å®ç°çš„ã€‚è¿™é‡Œç®€å•çœ‹ä¸‹CircuitBreakerçš„å®ç°è¿‡ç¨‹ã€‚\nåŸºæœ¬æ¶‰åŠä¸¤ä¸ªç±»\nCircuitBreakerConfigurationé…ç½®ç±»ï¼Œè´Ÿè´£å¯åŠ¨æ—¶åˆ›å»ºæ–­è·¯å™¨ç›¸å…³çš„Bean CircuitBreakerAspectåˆ‡é¢å¤„ç†ï¼ŒCircuitBreakeræ³¨è§£çš„å¤„ç† Beançš„ç”Ÿæˆ ä¸¤ä¸ªå…³é”®çš„Bean\nCircuitBreakerRegistry CircuitBreakerAspect 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @Bean @Primary public RegistryEventConsumer\u0026lt;CircuitBreaker\u0026gt; circuitBreakerRegistryEventConsumer( Optional\u0026lt;List\u0026lt;RegistryEventConsumer\u0026lt;CircuitBreaker\u0026gt;\u0026gt;\u0026gt; optionalRegistryEventConsumers) { // è‡ªå®šä¹‰çš„RegistryEventConsumerä¼šæ³¨å…¥è¿›æ¥ return new CompositeRegistryEventConsumer\u0026lt;\u0026gt;( optionalRegistryEventConsumers.orElseGet(ArrayList::new)); } @Bean public CircuitBreakerRegistry circuitBreakerRegistry( EventConsumerRegistry\u0026lt;CircuitBreakerEvent\u0026gt; eventConsumerRegistry, RegistryEventConsumer\u0026lt;CircuitBreaker\u0026gt; circuitBreakerRegistryEventConsumer, @Qualifier(\u0026#34;compositeCircuitBreakerCustomizer\u0026#34;) CompositeCustomizer\u0026lt;CircuitBreakerConfigCustomizer\u0026gt; compositeCircuitBreakerCustomizer) { CircuitBreakerRegistry circuitBreakerRegistry = createCircuitBreakerRegistry( circuitBreakerProperties, circuitBreakerRegistryEventConsumer, compositeCircuitBreakerCustomizer); registerEventConsumer(circuitBreakerRegistry, eventConsumerRegistry); // then pass the map here initCircuitBreakerRegistry(circuitBreakerRegistry, compositeCircuitBreakerCustomizer); return circuitBreakerRegistry; } @Bean @Conditional(value = {AspectJOnClasspathCondition.class}) public CircuitBreakerAspect circuitBreakerAspect( CircuitBreakerRegistry circuitBreakerRegistry, @Autowired(required = false) List\u0026lt;CircuitBreakerAspectExt\u0026gt; circuitBreakerAspectExtList, FallbackDecorators fallbackDecorators, SpelResolver spelResolver ) { return new CircuitBreakerAspect(circuitBreakerProperties, circuitBreakerRegistry, circuitBreakerAspectExtList, fallbackDecorators, spelResolver); } åˆ‡é¢å¤„ç†é€»è¾‘ åˆ‡é¢çš„é€»è¾‘æ¯”è¾ƒç®€å•\nçœ‹çœ‹æœ‰æ²¡æœ‰æ³¨è§£ circuitBreakerRegistryä¸­è·å–CircuitBreakerå®ä¾‹ æ˜¯å¦ä½¿ç”¨fallbackï¼Œä¸åŒçš„å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @Pointcut(value = \u0026#34;@within(circuitBreaker) || @annotation(circuitBreaker)\u0026#34;, argNames = \u0026#34;circuitBreaker\u0026#34;) public void matchAnnotatedClassOrMethod(CircuitBreaker circuitBreaker) { } @Around(value = \u0026#34;matchAnnotatedClassOrMethod(circuitBreakerAnnotation)\u0026#34;, argNames = \u0026#34;proceedingJoinPoint, circuitBreakerAnnotation\u0026#34;) public Object circuitBreakerAroundAdvice(ProceedingJoinPoint proceedingJoinPoint, @Nullable CircuitBreaker circuitBreakerAnnotation) throws Throwable { // æ–¹æ³•ä¸Šæœ‰æ²¡æœ‰æ³¨è§£ Method method = ((MethodSignature) proceedingJoinPoint.getSignature()).getMethod(); String methodName = method.getDeclaringClass().getName() + \u0026#34;#\u0026#34; + method.getName(); if (circuitBreakerAnnotation == null) { circuitBreakerAnnotation = getCircuitBreakerAnnotation(proceedingJoinPoint); } if (circuitBreakerAnnotation == null) { //because annotations wasn\u0026#39;t found return proceedingJoinPoint.proceed(); } // spelç›¸å…³çš„ String backend = spelResolver.resolve(method, proceedingJoinPoint.getArgs(), circuitBreakerAnnotation.name()); io.github.resilience4j.circuitbreaker.CircuitBreaker circuitBreaker = getOrCreateCircuitBreaker( methodName, backend); Class\u0026lt;?\u0026gt; returnType = method.getReturnType(); String fallbackMethodValue = spelResolver.resolve(method, proceedingJoinPoint.getArgs(), circuitBreakerAnnotation.fallbackMethod()); // æ²¡æœ‰fallback if (StringUtils.isEmpty(fallbackMethodValue)) { return proceed(proceedingJoinPoint, methodName, circuitBreaker, returnType); } // æœ‰fallback FallbackMethod fallbackMethod = FallbackMethod .create(fallbackMethodValue, method, proceedingJoinPoint.getArgs(), proceedingJoinPoint.getTarget()); return fallbackDecorators.decorate(fallbackMethod, () -\u0026gt; proceed(proceedingJoinPoint, methodName, circuitBreaker, returnType)).apply(); } é™„å½• å‚è€ƒ å®˜æ–¹æ•™ç¨‹ How to configure to events in Resilience4j Spring starter ","date":"2024-02-02T11:18:46+08:00","image":"https://gloryjie.github.io/p/resilience4j-%E6%95%B4%E5%90%88springboot/cover_hu3163765b57fc9a9b6b4dbc88ef7da476_2717844_120x120_fill_q75_box_smart1.jpg","permalink":"https://gloryjie.github.io/p/resilience4j-%E6%95%B4%E5%90%88springboot/","title":"Resilience4j-æ•´åˆSpringboot"},{"content":" äº¤å‹ï¼šæ‰©å……åœˆå­ï¼Œå¤šè®¤è¯†å¦¹å­ï¼Œå¤šèŠ±æ—¶é—´è¿›è¡Œçº¿ä¸Šäº¤æµï¼›èˆå¾—èŠ±é’±æ‰“æ‰® é˜…è¯»ï¼šéæŠ€æœ¯ä¹¦ç±20+æœ¬ï¼ŒæŠ€æœ¯ä¹¦ç±10+ï¼Œç½‘æ–‡1æœ¬ è¿åŠ¨ï¼šè·µè¡Œå¹²å‡€å¢è‚Œï¼Œ8ä¸ªæœˆå¢è‚Œã€3ä¸ªæœˆå‡è„‚ï¼Œç›®æ ‡65kg æ¸¸æˆï¼šæ‰“å®Œ5+æ¸¸æˆï¼Œæ­»äº¡ææµ…ã€åªç‹¼ã€è‰¾å°”ç™»æ³•ç¯ã€ffe7ç­‰ æŠ€æœ¯æå‡ï¼šåŸºç¡€å¢å¼ºï¼ˆç½‘ç»œã€æ“ä½œç³»ç»Ÿï¼‰ã€ç®—æ³•LCåˆ·é¢˜100é“ã€æ¥è§¦AIGC æŠ€æœ¯è¯¾ç¨‹ï¼šè‡³å°‘ä¸€é—¨å›½å¤–è¯¾ç¨‹ï¼ˆçœ‹å®Œå¹¶åšå®Œå®éªŒï¼‰ï¼Œä¾‹å¦‚MIT6.824ã€MIT6.S081 é¡¹ç›®å®è·µï¼šè®¾è®¡ä¸€ä¸ªä¸ªäººé¡¹ç›®å¹¶ä¸Šçº¿è¿è¡Œ æŠ•èµ„ç†è´¢ï¼šç»§ç»­å­¦ä¹ ç›¸å…³çŸ¥è¯†ï¼Œåœ¨å°½å¯èƒ½ä¸å¢åŠ èµ„é‡‘çš„æƒ…å†µä¸‹ï¼Œå›æœ¬ï¼ ç”Ÿæ´»ä½“éªŒï¼šå‡ºè¡Œæ¸¸ç©ï¼Œå¦‚æ­¦åŠŸå±±ã€æ­¦æ±‰ã€ä¹å¯¨æ²Ÿ æ–°æŠ€èƒ½ï¼šæ‰‹æœºæ‘„å½±\u0026amp;å‰ªè¾‘ ä¹ æƒ¯å…»æˆç›®æ ‡\n12ç‚¹å‰å…¥ç¡ï¼Œ7ç‚¹èµ· è¡Œè·¯ä¸­ï¼Œä¸ç©æ‰‹æœº æ¯å‘¨è¿›è¡Œæ€»ç»“ æ¯æœˆ1~2æœ¬ä¹¦ é™ä½æ‹–å»¶ç—‡ ","date":"2024-01-04T17:47:55+08:00","image":"https://gloryjie.github.io/p/2024%E5%B9%B4%E5%BA%A6%E8%AE%A1%E5%88%92/cover_hu6b62954a64c9532f0495ca1fd21ae92d_130115_120x120_fill_box_smart1_3.png","permalink":"https://gloryjie.github.io/p/2024%E5%B9%B4%E5%BA%A6%E8%AE%A1%E5%88%92/","title":"2024å¹´åº¦è®¡åˆ’"}]